"use strict";function rfc2083_make_crc_table(){var a,b,c;for(b=0;256>b;b++){for(a=b,c=0;8>c;c++)1&a?a=4294967295&(3988292384^a>>>1)>>>0:a>>>=1;rfc2083_crc_table[b]=a}rfc2083_crc_table_computed=1}function rfc2083_update_crc(a,b,c,d){var f,e=a;for(rfc2083_crc_table_computed||rfc2083_make_crc_table(),f=0;d>f;f++)e=rfc2083_crc_table[255&(e^b[c+f])]^e>>>8;return e}function rfc2083_crc(a,b,c){return 4294967295^rfc2083_update_crc(4294967295,a,b,c)}function crc32(a,b,c){var d=new Uint8Array(a);return rfc2083_crc(d,b,c)}function PngIHDR(a,b){this.width=a,this.height=b,this.depth=8,this.type=6,this.compression=0,this.filter=0,this.interlace=0}function adler(){this.s1=1,this.s2=0}function PngIDAT(a,b,c){if(c.byteLength>65535)throw new Error("Cannot handle more than 64K");this.data=c,this.width=a,this.height=b}function PngIEND(){}function create_rgba_png(a,b,c){var d,j,k,e=new PngIHDR(a,b),f=new PngIDAT(a,b,c),g=new PngIEND,h=new ArrayBuffer(e.buffer_size()+f.buffer_size()+g.buffer_size()),i=e.to_buffer(h);for(i=f.to_buffer(h,i),i=g.to_buffer(h,i),j=new Uint8Array(h),k="",d=0;i>d;d++)k+="%",j[d]<16&&(k+="0"),k+=j[d].toString(16);return"%89PNG%0D%0A%1A%0A"+k}var rfc2083_crc_table=Array(256),rfc2083_crc_table_computed=0;PngIHDR.prototype={to_buffer:function(a,b){var c,d;return b=b||0,c=b,d=new SpiceDataView(a),d.setUint32(b,this.buffer_size()-12),b+=4,d.setUint8(b,"I".charCodeAt(0)),b++,d.setUint8(b,"H".charCodeAt(0)),b++,d.setUint8(b,"D".charCodeAt(0)),b++,d.setUint8(b,"R".charCodeAt(0)),b++,d.setUint32(b,this.width),b+=4,d.setUint32(b,this.height),b+=4,d.setUint8(b,this.depth),b++,d.setUint8(b,this.type),b++,d.setUint8(b,this.compression),b++,d.setUint8(b,this.filter),b++,d.setUint8(b,this.interlace),b++,d.setUint32(b,crc32(a,c+4,this.buffer_size()-8)),b+=4},buffer_size:function(){return 25}},adler.prototype.update=function(a){this.s1+=a,this.s1%=65521,this.s2+=this.s1,this.s2%=65521},PngIDAT.prototype={to_buffer:function(a,b){var c,d,e,f,h,i,j;for(b=b||0,c=b,h=new SpiceDataView(a),i=new adler,h.setUint32(b,this.buffer_size()-12),b+=4,h.setUint8(b,"I".charCodeAt(0)),b++,h.setUint8(b,"D".charCodeAt(0)),b++,h.setUint8(b,"A".charCodeAt(0)),b++,h.setUint8(b,"T".charCodeAt(0)),b++,h.setUint8(b,120),b++,h.setUint8(b,1),b++,h.setUint8(b,128),b++,h.setUint16(b,this.data.byteLength+this.height),b+=2,h.setUint16(b,~(this.data.byteLength+this.height)),b+=2,j=new Uint8Array(this.data),f=0,e=0;e<this.height;e++)for(h.setUint8(b,0),b++,i.update(0),d=0;d<this.width&&f<this.data.byteLength;d++)i.update(j[f]),h.setUint8(b,j[f++]),b++,i.update(j[f]),h.setUint8(b,j[f++]),b++,i.update(j[f]),h.setUint8(b,j[f++]),b++,i.update(j[f]),h.setUint8(b,j[f++]),b++;return h.setUint16(b,i.s2),b+=2,h.setUint16(b,i.s1),b+=2,h.setUint32(b,crc32(a,c+4,this.buffer_size()-8)),b+=4},buffer_size:function(){return 12+this.data.byteLength+this.height+4+2+1+2+2}},PngIEND.prototype={to_buffer:function(a,b){var c,e;return b=b||0,c=b,e=new SpiceDataView(a),e.setUint32(b,this.buffer_size()-12),b+=4,e.setUint8(b,"I".charCodeAt(0)),b++,e.setUint8(b,"E".charCodeAt(0)),b++,e.setUint8(b,"N".charCodeAt(0)),b++,e.setUint8(b,"D".charCodeAt(0)),b++,e.setUint32(b,crc32(a,c+4,this.buffer_size()-8)),b+=4},buffer_size:function(){return 12}};